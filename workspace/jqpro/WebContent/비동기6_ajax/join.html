<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="icon" href="../images/favicon-java-color.png" type="image/png">
    
    <!-- <link rel="stylesheet" href="../css/public.css"> -->
    <script src="../js/jquery-3.7.1.js"></script>
    <script src="../js/jquery.serializejson.min.js"></script>
    
    <!-- bootstrap -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    

	<style>
		.ziptr:hover {
			background: rgb(0,98,65);
			color: white;
		}
	</style>

	<script>
		$(()=>{
			// id 입력 규칙
			$('#id').on('keyup', function(){
				userId = $('#id').val().trim();
				idreg = /^[a-z][a-zA-Z0-9]{3,11}$/ // ^로 시작하고 $로 끝난다 정규식 // 첫자리는 a-z 사이만 가능, 2, 3, 4 자리는 aA0 다 가능하고 4자리에서 12자리까지만 가능
				if(!(idreg.test(userId))){ // 입력한 아이디가 틀렸으면,
					$(this).css('border', '2px solid red');
					$('#idcheck').prop('disabled', true); // 중복검사 버튼 가져와서, 상태값을 사용불가로 변경
				} else {
					$(this).css('border', '2px solid blue');
					$('#idcheck').prop('disabled', false);
				}
			})
			
			// id 중복 검사
			$('#idcheck').on('click', ()=>{
				// 입력한 id값을 가져온다
				userId = $('#id').val().trim();
				
				if(userId.length<1) {
					alert("id를 입력하세요");
					return;
				}
				
				$.ajax({
					url : '/jqpro/IdCheck.do', // 이거 Servlet Mapping 이름이다! 이거 확실하게 알아야 한다. servlet 이름이다 이게.
					type : 'get',
					data : {id : userId}, // data : "id="+userId, // 이거랑 같은거다. 앞은 객체타입, 뒤는 문자타입
					success : function(res){
						$('#idspan').html(res.flag).css('color', 'red');
					},
					error : function(xhr){
						alert("오류"+xhr.status)
						// 200 = json 형식 잘못되어서 역직렬화 실패
						// 500 = 코딩 잘못됨
						// 404 = 링크 잘못 걸음
					},
					dataType : 'json'
				})
			}) // id 중복 검사 끝
			
			// 우편번호 찾기
			$('#zipbtn').on('click', ()=>{
				// 입력한 동 이름 가져오기
				dongvalue = $('#dong').val().trim();
				
				if(dongvalue.length<1) {
					// alert("동 이름을 입력하세요");
					console.log("동 이름을 입력하세요");
					return;
				}
				$.ajax({
					url : '/jqpro/ZipSearch.do',
					type : 'post',
					data : {dong : dongvalue}, // data : "dong="+dongvalue, // 파라미터로 읽기 // 이거는 get post 다 가능.
					// data : JSON.stringify({dong : dongvalue}), // reader로 읽기 // post에서는 이렇게도 가능. post만 가능.
					// 뒤에 dong 써놓은게 key 같은거다. servlet에서 이걸로 뒤에 dongvalue를 가져가는거.
					success : function(res){
						// console.log(res);
						
						//code = "<table class='table table-hover'>";
						code = "<table>";
						code += "<tr>";
						code += "<td>우편번호</td>";
						code += "<td>주소</td>";
						code += "<td>검색</td>";
						code += "</tr>";
						code += `<tr><td colspan='3'><hr></td></tr>`;
						
						// jquery 방식 반복문으로 출력하기
						$.each(res, function(i,v){ // i v 없어도 된다는데 무슨 말이지 모르겠음
							
							addr = `${v.sido} ${v.gugun} ${v.dong}`;
							bunji = v.bunji;
							if(bunji==null) bunji="";
							// 뭐는 $() 이고 뭐는 ${} 인거지..
							code += `<tr class='ziptr'>
									 <td>${v.zipcode}</td>
									 <td>${addr}</td>
									 <td>${bunji}</td>
									 </tr>`;
							// code += `――――――――――――――――――――――`;
							// code += `------------------------`;
							// code += `ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ`;
							code += `<tr><td colspan='3'><hr></td></tr>`;
						})
						code += "</table>";
						$('#result').html(code);
					},
					error : function(xhr){
						alert("error: "+xhr.status);
					},
					dataType : 'json'
				})
			}) // 우편번호 검색 끝
			// 우편번호 찾기 결과에서 하나를 클릭하면
			$(document).on('click', '.ziptr', function(){
				// $('this td:eq(0)')
				// 선택한 행에서 우편번호와 주소를 가져오기
				zcode = $('td:eq(0)', this).text().trim();
				addr = $('td:eq(1)', this).text().trim();
				
				// 본문에 출력하기
				$('#zip').val(zcode);
				$('#add1').val(addr);
				
				// 출력창 데이터 지우기. 두가지 방법이 있음.
				$('#dong').val("");
				$('#result').empty();
				
				
				// 모달창 닫기
				$('#myModal').modal('hide');
			})
			
			// 가입 전송버튼 클릭
			$('#send').on('click', function(){
				// 입력한 모든 값을 가져온다 - val()
				/* $('#id').val()
				$('#name')*/
				fdata1 = $('#ff').serialize();
				fdata2 = $('#ff').serializeArray();
				
				console.log(fdata1);
				console.log(fdata2);
				
				fdata3 = $('#ff').serializeJSON();
				console.log(fdata3);
				
				$.ajax({
					url : '/jqpro/insertMember.do', // 앞에 /로 시작하지 않으면 '현재폴더에서' 가 됨. 잘 기억할 것.
					data : JSON.stringify(fdata3), // script 객체를 json 형식의 문자열로 직렬화
					contentType : 'application/json',
					type : 'post',
					success : (res)=>{
						// alert(res.flag);
						$('#joinspan').html(res.flag).css('color', 'red');
					},
					error : (xhr)=>{
						alert("오류: "+xhr.status);
					},
					dataType : 'json' // res json 형식의 문자열 - scipr객체로 역직렬화
				})
			}) // 가입 전송버튼 끝
		})
	</script>

</head>

<body>

    <div class="box">
        <h1>
			1. 
        </h1>

		<div class="container mt-3">
			<h2>회원가입</h2>
			<form id="ff">
				<div class="mb-3 mt-3">
					<label for="id">아이디:</label>
					<input type="button" value="중복검사" id="idcheck"  class="btn btn-success btn-sm">
					<span class="spinner-grow spinner-grow-sm"></span> 확인중..
					<span id="idspan"></span>
					<input type="text" class="form-control" id="id" placeholder="Enter id" name="mem_id"> <!-- name은 db와 일치시킨 VO와 일치시켜야 한다 -->
				</div>
				
				<div class="mb-3 mt-3">
					<label for="name">이름:</label>
					<input type="text" class="form-control" id="name" placeholder="Enter name" name="mem_name"> <!-- name은 db와 일치시킨 VO와 일치시켜야 한다 -->
				</div>
								
				<div class="mb-3 mt-3">
					<label for="hp">전화번호:</label>
					<input type="text" class="form-control" id="hp" placeholder="Enter hp" name="mem_hp"> <!-- name은 db와 일치시킨 VO와 일치시켜야 한다 -->
				</div>
				
				<div class="mb-3 mt-3">
					<label for="bir">생일:</label>
					<input type="date" class="form-control" id="bir" placeholder="Enter bir" name="mem_bir"> <!-- name은 db와 일치시킨 VO와 일치시켜야 한다 -->
				</div>
				
				<div class="mb-3 mt-3">
					<label for="email">이메일:</label>
					<input type="email" class="form-control" id="email" placeholder="Enter email" name="mem_mail"> <!-- name은 db와 일치시킨 VO와 일치시켜야 한다 -->
				</div>
				
				<div class="mb-3">
					<label for="pass">비밀번호:</label>
					<input type="password" class="form-control" id="pass" placeholder="Enter pass" name="mem_pass">
				</div>
				
				<div class="mb-3 mt-3">
					<label for="zip">우편번호:</label>
					<input type="button" value="번호검색" id="dongbtn"  class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#myModal">
					<input type="text" class="form-control" id="zip" placeholder="Enter zip" name="mem_zip"> <!-- name은 db와 일치시킨 VO와 일치시켜야 한다 -->
				</div>
				
				<div class="mb-3 mt-3">
					<label for="add1">주소:</label>
					<input type="text" class="form-control" id="add1" placeholder="Enter add1" name="mem_add1"> <!-- name은 db와 일치시킨 VO와 일치시켜야 한다 -->
				</div>
				
				<div class="mb-3 mt-3">
					<label for="add2">상세주소:</label>
					<input type="text" class="form-control" id="add2" placeholder="Enter add2" name="mem_add2"> <!-- name은 db와 일치시킨 VO와 일치시켜야 한다 -->
				</div>
				
				<button type="button" class="btn btn-primary" id="send">가입</button>
				<span id="joinspan"></span>
			</form>
		</div>

	</div>


	<!-- The Modal : 우편번호 찾기 -->
	<div class="modal" id="myModal">
		<div class="modal-dialog">
			<div class="modal-content">

				<!-- Modal Header -->
				<div class="modal-header">
					<h4 class="modal-title">우편번호 찾기</h4>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>

				<!-- Modal body -->
				<div class="modal-body">
					동 이름 입력
					<input type="text" id="dong" placeholder="동이름">
					<input type="button" value="확인" id="zipbtn">
					<br><br>
					<div id="result">
						
					</div>
				</div>

				<!-- Modal footer -->
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
				</div>

			</div>
		</div>
	</div>







</body>
</html>





















































































































